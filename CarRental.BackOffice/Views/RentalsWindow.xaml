<Window x:Class="CarRental.BackOffice.Views.RentalsWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="clr-namespace:CarRental.BackOffice.ViewModels"
        Title="Manage Rentals - Car Rental System" 
        Height="700" 
        Width="1000"
        WindowStartupLocation="CenterScreen">
    
    <Window.DataContext>
        <vm:RentalsViewModel/>
    </Window.DataContext>
    
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>
        
        <!-- Header -->
        <Border Grid.Row="0" Background="#007ACC" Padding="15">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                
                <Button Grid.Column="0" 
                       Content="← Back" 
                       Click="BackButton_Click"
                       Background="Transparent"
                       BorderBrush="White"
                       Foreground="White"
                       Padding="10 5"/>
                
                <TextBlock Grid.Column="1" 
                          Text="📋 Rental Management" 
                          Foreground="White" 
                          FontSize="18" 
                          FontWeight="Bold"
                          VerticalAlignment="Center"
                          HorizontalAlignment="Center"/>
                
                <StackPanel Grid.Column="2" Orientation="Horizontal">
                    <Button Content="🔄" 
                           Command="{Binding RefreshCommand}"
                           ToolTip="Refresh"
                           Background="Transparent"
                           BorderBrush="White"
                           Foreground="White"
                           Width="40"/>
                </StackPanel>
            </Grid>
        </Border>
        
        <!-- Toolbar -->
        <Border Grid.Row="1" Background="#F8F9FA" Padding="10">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                
                <StackPanel Grid.Column="0" Orientation="Horizontal">
                    <TextBox Width="200"
                            Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}"
                            Height="35"
                            Padding="10"
                            Margin="0 0 10 0"
                            Background="White">
                        <TextBox.Style>
                            <Style TargetType="TextBox">
                                <Setter Property="Tag" Value="🔍 Search rentals..."/>
                                <Style.Triggers>
                                    <Trigger Property="Text" Value="">
                                        <Setter Property="Foreground" Value="Gray"/>
                                        <Setter Property="Text" Value="{Binding Tag, RelativeSource={RelativeSource Self}}"/>
                                    </Trigger>
                                </Style.Triggers>
                            </Style>
                        </TextBox.Style>
                    </TextBox>
                    
                    <ComboBox Width="150"
                             ItemsSource="{Binding StatusFilters}"
                             SelectedItem="{Binding SelectedStatusFilter}"
                             Height="35"
                             Padding="5"/>
                </StackPanel>
                
                <StackPanel Grid.Column="1" Orientation="Horizontal">
                    <Button Content="➕ New Rental" 
                           Command="{Binding AddRentalCommand}"
                           Background="#28A745"
                           Width="120"/>
                    
                    <Button Content="✏️ Edit" 
                           Command="{Binding EditRentalCommand}"
                           IsEnabled="{Binding IsRentalSelected}"
                           Width="80"
                           Margin="10 0 0 0"/>
                    
                    <Button Content="✅ Complete" 
                           Command="{Binding CompleteRentalCommand}"
                           IsEnabled="{Binding CanCompleteRental}"
                           Background="#17A2B8"
                           Width="100"
                           Margin="10 0 0 0"/>
                    
                    <Button Content="📄 Invoice" 
                           Command="{Binding GenerateInvoiceCommand}"
                           IsEnabled="{Binding IsRentalSelected}"
                           Background="#6F42C1"
                           Width="100"
                           Margin="10 0 0 0"/>
                    
                    <Button Content="📊 Report" 
                           Command="{Binding GenerateReportCommand}"
                           Background="#FD7E14"
                           Width="100"
                           Margin="10 0 0 0"/>
                </StackPanel>
            </Grid>
        </Border>
        
        <!-- Data Grid -->
        <DataGrid Grid.Row="2" 
                 ItemsSource="{Binding Rentals}"
                 SelectedItem="{Binding SelectedRental}"
                 AutoGenerateColumns="False"
                 CanUserAddRows="False"
                 CanUserDeleteRows="False"
                 IsReadOnly="True">
            <DataGrid.Columns>
                <DataGridTextColumn Header="ID" Binding="{Binding Id}" Width="60"/>
                <DataGridTextColumn Header="Client" Binding="{Binding ClientName}" Width="150"/>
                <DataGridTextColumn Header="Vehicle" Binding="{Binding VehicleInfo}" Width="200"/>
                <DataGridTextColumn Header="Start Date" Binding="{Binding StartDate, StringFormat=yyyy-MM-dd}" Width="100"/>
                <DataGridTextColumn Header="End Date" Binding="{Binding EndDate, StringFormat=yyyy-MM-dd}" Width="100"/>
                <DataGridTextColumn Header="Total Amount" Binding="{Binding TotalAmount, StringFormat=C}" Width="100"/>
                <DataGridTextColumn Header="Deposit" Binding="{Binding Deposit, StringFormat=C}" Width="90"/>
                <DataGridTextColumn Header="Status" Binding="{Binding Status}" Width="100"/>
                <DataGridTextColumn Header="Created" Binding="{Binding CreatedAt, StringFormat=yyyy-MM-dd}" Width="100"/>
            </DataGrid.Columns>
            
            <DataGrid.CellStyle>
                <Style TargetType="DataGridCell">
                    <Style.Triggers>
                        <DataTrigger Binding="{Binding Status}" Value="Active">
                            <Setter Property="Background" Value="#E8F5E9"/>
                            <Setter Property="Foreground" Value="#28A745"/>
                            <Setter Property="FontWeight" Value="Bold"/>
                        </DataTrigger>
                        <DataTrigger Binding="{Binding Status}" Value="Reserved">
                            <Setter Property="Background" Value="#E3F2FD"/>
                            <Setter Property="Foreground" Value="#007ACC"/>
                        </DataTrigger>
                        <DataTrigger Binding="{Binding Status}" Value="Completed">
                            <Setter Property="Background" Value="#F3E5F5"/>
                            <Setter Property="Foreground" Value="#6F42C1"/>
                        </DataTrigger>
                        <DataTrigger Binding="{Binding Status}" Value="Cancelled">
                            <Setter Property="Background" Value="#FFF5F5"/>
                            <Setter Property="Foreground" Value="#DC3545"/>
                        </DataTrigger>
                    </Style.Triggers>
                </Style>
            </DataGrid.CellStyle>
        </DataGrid>
        
        <!-- Status Bar -->
        <Border Grid.Row="3" Background="#E9ECEF" Padding="10">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                
                <TextBlock Grid.Column="0" 
                          Text="{Binding StatusMessage}"
                          Foreground="#6C757D"
                          VerticalAlignment="Center"/>
                
                <StackPanel Grid.Column="2" Orientation="Horizontal">
                    <TextBlock Text="Active: "
                             Foreground="#6C757D"
                             VerticalAlignment="Center"/>
                    <TextBlock Text="{Binding ActiveRentalsCount}"
                             Foreground="#28A745"
                             FontWeight="Bold"
                             VerticalAlignment="Center"
                             Margin="0 0 10 0"/>
                    
                    <TextBlock Text="Total Revenue: "
                             Foreground="#6C757D"
                             VerticalAlignment="Center"
                             Margin="10 0 0 0"/>
                    <TextBlock Text="{Binding TotalRevenue, StringFormat=C}"
                             Foreground="#28A745"
                             FontWeight="Bold"
                             VerticalAlignment="Center"/>
                </StackPanel>
            </Grid>
        </Border>
    </Grid>
</Window>