<Window x:Class="CarRental.BackOffice.Views.PaymentsWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="clr-namespace:CarRental.BackOffice.ViewModels"
        Title="Manage Payments - Car Rental System" 
        Height="700" 
        Width="1100"
        WindowStartupLocation="CenterScreen">
    
    <Window.DataContext>
        <vm:PaymentsViewModel/>
    </Window.DataContext>
    
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>
        
        <!-- Header -->
        <Border Grid.Row="0" Background="#007ACC" Padding="15">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                
                <Button Grid.Column="0" 
                       Content="← Back" 
                       Click="BackButton_Click"
                       Background="Transparent"
                       BorderBrush="White"
                       Foreground="White"
                       Padding="10 5"/>
                
                <TextBlock Grid.Column="1" 
                          Text="💰 Payment Management" 
                          Foreground="White" 
                          FontSize="18" 
                          FontWeight="Bold"
                          VerticalAlignment="Center"
                          HorizontalAlignment="Center"/>
                
                <StackPanel Grid.Column="2" Orientation="Horizontal">
                    <Button Content="🔄" 
                           Command="{Binding RefreshCommand}"
                           ToolTip="Refresh"
                           Background="Transparent"
                           BorderBrush="White"
                           Foreground="White"
                           Width="40"/>
                </StackPanel>
            </Grid>
        </Border>
        
        <!-- Toolbar -->
        <Border Grid.Row="1" Background="#F8F9FA" Padding="10">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                
                <StackPanel Grid.Column="0" Orientation="Horizontal">
                    <TextBox Width="200"
                            Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}"
                            Height="35"
                            Padding="10"
                            Margin="0 0 10 0"
                            Background="White">
                        <TextBox.Style>
                            <Style TargetType="TextBox">
                                <Setter Property="Tag" Value="🔍 Search payments..."/>
                                <Style.Triggers>
                                    <Trigger Property="Text" Value="">
                                        <Setter Property="Foreground" Value="Gray"/>
                                        <Setter Property="Text" Value="{Binding Tag, RelativeSource={RelativeSource Self}}"/>
                                    </Trigger>
                                </Style.Triggers>
                            </Style>
                        </TextBox.Style>
                    </TextBox>
                    
                    <DatePicker Width="120"
                               SelectedDate="{Binding StartDate}"
                               Height="35"
                               Margin="0 0 5 0"/>
                    
                    <TextBlock Text="to"
                             VerticalAlignment="Center"
                             Margin="5 0 5 0"/>
                    
                    <DatePicker Width="120"
                               SelectedDate="{Binding EndDate}"
                               Height="35"/>
                    
                    <ComboBox Width="120"
                             ItemsSource="{Binding StatusFilters}"
                             SelectedItem="{Binding SelectedStatusFilter}"
                             Height="35"
                             Margin="10 0 0 0"
                             Padding="5"/>
                </StackPanel>
                
                <StackPanel Grid.Column="1" Orientation="Horizontal">
                    <Button Content="➕ New Payment" 
                           Command="{Binding AddPaymentCommand}"
                           Background="#28A745"
                           Width="120"/>
                    
                    <Button Content="✏️ Edit" 
                           Command="{Binding EditPaymentCommand}"
                           IsEnabled="{Binding IsPaymentSelected}"
                           Width="80"
                           Margin="10 0 0 0"/>
                    
                    <Button Content="✅ Process" 
                           Command="{Binding ProcessPaymentCommand}"
                           IsEnabled="{Binding CanProcessPayment}"
                           Background="#17A2B8"
                           Width="100"
                           Margin="10 0 0 0"/>
                    
                    <Button Content="📊 Report" 
                           Command="{Binding GenerateReportCommand}"
                           Background="#FD7E14"
                           Width="100"
                           Margin="10 0 0 0"/>
                    
                    <Button Content="📈 Export" 
                           Command="{Binding ExportCommand}"
                           Background="#6F42C1"
                           Width="100"
                           Margin="10 0 0 0"/>
                </StackPanel>
            </Grid>
        </Border>
        
        <!-- Data Grid -->
        <DataGrid Grid.Row="2" 
                 ItemsSource="{Binding Payments}"
                 SelectedItem="{Binding SelectedPayment}"
                 AutoGenerateColumns="False"
                 CanUserAddRows="False"
                 CanUserDeleteRows="False"
                 IsReadOnly="True">
            <DataGrid.Columns>
                <DataGridTextColumn Header="ID" Binding="{Binding Id}" Width="60"/>
                <DataGridTextColumn Header="Rental ID" Binding="{Binding RentalId}" Width="80"/>
                <DataGridTextColumn Header="Client" Binding="{Binding ClientName}" Width="150"/>
                <DataGridTextColumn Header="Vehicle" Binding="{Binding VehicleInfo}" Width="150"/>
                <DataGridTextColumn Header="Amount" Binding="{Binding Amount, StringFormat=C}" Width="100"/>
                <DataGridTextColumn Header="Method" Binding="{Binding PaymentMethod}" Width="100"/>
                <DataGridTextColumn Header="Date" Binding="{Binding PaymentDate, StringFormat=yyyy-MM-dd}" Width="100"/>
                <DataGridTextColumn Header="Status" Binding="{Binding Status}" Width="100"/>
                <DataGridTextColumn Header="Transaction ID" Binding="{Binding TransactionId}" Width="150"/>
            </DataGrid.Columns>
            
            <DataGrid.CellStyle>
                <Style TargetType="DataGridCell">
                    <Style.Triggers>
                        <DataTrigger Binding="{Binding Status}" Value="Completed">
                            <Setter Property="Background" Value="#E8F5E9"/>
                            <Setter Property="Foreground" Value="#28A745"/>
                            <Setter Property="FontWeight" Value="Bold"/>
                        </DataTrigger>
                        <DataTrigger Binding="{Binding Status}" Value="Pending">
                            <Setter Property="Background" Value="#FFF3CD"/>
                            <Setter Property="Foreground" Value="#856404"/>
                        </DataTrigger>
                        <DataTrigger Binding="{Binding Status}" Value="Failed">
                            <Setter Property="Background" Value="#F8D7DA"/>
                            <Setter Property="Foreground" Value="#721C24"/>
                        </DataTrigger>
                    </Style.Triggers>
                </Style>
            </DataGrid.CellStyle>
        </DataGrid>
        
        <!-- Status Bar -->
        <Border Grid.Row="3" Background="#E9ECEF" Padding="10">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                
                <TextBlock Grid.Column="0" 
                          Text="{Binding StatusMessage}"
                          Foreground="#6C757D"
                          VerticalAlignment="Center"/>
                
                <StackPanel Grid.Column="2" Orientation="Horizontal">
                    <TextBlock Text="Total Payments: "
                             Foreground="#6C757D"
                             VerticalAlignment="Center"/>
                    <TextBlock Text="{Binding TotalPaymentsCount}"
                             Foreground="#007ACC"
                             FontWeight="Bold"
                             VerticalAlignment="Center"
                             Margin="0 0 10 0"/>
                    
                    <TextBlock Text="Total Amount: "
                             Foreground="#6C757D"
                             VerticalAlignment="Center"
                             Margin="10 0 0 0"/>
                    <TextBlock Text="{Binding TotalAmount, StringFormat=C}"
                             Foreground="#28A745"
                             FontWeight="Bold"
                             VerticalAlignment="Center"
                             Margin="0 0 10 0"/>
                    
                    <TextBlock Text="Completed: "
                             Foreground="#6C757D"
                             VerticalAlignment="Center"
                             Margin="10 0 0 0"/>
                    <TextBlock Text="{Binding CompletedPaymentsCount}"
                             Foreground="#28A745"
                             FontWeight="Bold"
                             VerticalAlignment="Center"/>
                </StackPanel>
            </Grid>
        </Border>
    </Grid>
</Window>